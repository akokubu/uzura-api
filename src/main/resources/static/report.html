<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>帳票アプリ</title>
<link rel="stylesheet" href="./bower_components/bootstrap-css-only/css/bootstrap.min.css" />
<link rel="stylesheet" href="./css/style.css" />
    

</head>
<body ng-app="ReportApp">

  <header class="container">
    <nav class="navbar navbar-default">
      <div class="navbar-header">
        <a href="#/" class="navbar-brand">帳票アプリ</a>
      </div>
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#/">帳票一覧</a></li>
          <li><a href="#/new">帳票作成</a></li>    
        </ul>
      </div>
    </nav>
  </header>

  <div class="container" ng-view></div>

  <script type="text/javascript" src="./bower_components/angular/angular.min.js"></script>
  <script type="text/javascript" src="./bower_components/angular-route/angular-route.min.js"></script>
  <script type="text/javascript" src="./app/report_app.js"></script>

  <script type="text/ng-template" id="index-tmpl">
    <h1>帳票一覧</h1>
    <ul ng-show="list.length">
      <li ng-repeat="sheet in list">
        #{{ sheet.id }}
        {{ sheet.createdAt | date: 'yyyy/MM/dd HH:mm' }}
        <a ng-href="#/sheet/{{ sheet.id }}">詳細を確認する</a>
      </li>
    </ul>
    <div class="alert alert-info" ng-hide="list.length">
      帳票が存在しません <a href="#/new" class="alert-link">新しい帳票を作る</a>
    </div>
  </script>

  <script type="text/ng-template" id="new-tmpl">
    <h1>帳票作成</h1>
    <form novalidate name="sheetForm" ng-submit="save()">
      <table class="table">
        <colgroup</colgroup>
        <colgroup span="3" class="col-sm"></colgroup>
        <colgroup</colgroup>
        <thead>
          <tr>
            <th>商品名</th>
            <th>単価</th>
            <th>個数</th>
            <th>小計</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="orderLine in lines">
            <td><input class="form-control" type="text" ng-model="orderLine.productName" required/></th>
            <td><input class="form-control" type="number" ng-model="orderLine.unitPrice" required min="0" ng-pattern="/^\d+$/" /></th>
            <td><input class="form-control" type="number" ng-model="orderLine.count" required min="0" ng-pattern="/^\d+$/" /></th>
            <td>{{ getSubtotal(orderLine) | number }}</td>
            <td><button type="button" class="btn btn-default" ng-disabled="lines.length < 2" ng-click="removeLine(orderLine)">削除</button></td>
          </tr>
        </tbody>
          <tr>
            <td colspan="3">合計：</td>
            <td colspan="2">{{ getTotalAmount(lines) | number }}</td>
          </tr>
        </tfoot>
      </table>

      <div class="alert alert-danger" ng-show="sheetForm.$invalid">
        <span ng-show="sheetForm.$error.required">空欄が存在しています。</span>
        <span ng-show="sheetForm.$error.min">単価、個数の最小値は0です。</span>
        <span ng-show="sheetForm.$error.number">単価、個数は整数で指定してください。</span>
      </div>

      <div>
        <button type="button" class="btn btn-primary" ng-click="addLine()">明細行を追加</button>
        <button type="button" class="btn btn-danger" ng-click="initialize()">帳票を初期化</button>
        <button type="submit" class="btn btn-success" ng-disabled="sheetForm.$invalid">帳票を保存</button>
      </div>
    </form>
  </script>
  
  <script type="text/ng-template" id="sheet-tmpl">
    <div ng-show="id">
    <h1>帳票詳細 #{{ id }}</h1>
    <p>作成日時： {{ createdAt | date: 'yyyy/MM/dd HH:mm' }}</p>
    <table class="table">
      <thead>
        <tr>
          <th>商品名</th>
          <th>単価</th>
          <th>個数</th>
          <th>小計</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="orderLine in lines">
          <td>{{ orderLine.productName }}</td>
          <td>{{ orderLine.unitPrice | number }}</td>
          <td>{{ orderLine.count | number }}</td>
          <td>{{ getSubtotal(orderLine) | number }}</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3">合計：</td>
          <td>{{ getTotalAmount(lines) | number }}</td>
        </tr>
      </tfoot>
    </table>
    </div>
    <div ng-hide="id" class="alert alert-danger">
      存在しない帳票を参照しています。<a href="#/new" class="alert-link">新しい帳票を作る</a>
    </div>

  </script>
</body>
</html>